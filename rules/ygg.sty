% (c) 2020 Stefan Antonowicz
% Based off of tex found at https://github.com/ludus-leonis/nipajin
% This file is released under Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.
% Please do not apply other licenses one-way.

\ProvidesFile{ygg.sty}
\ProvidesPackage{ygg}

% --- common packages --------------------------------------------------

\usepackage[cmyk,table,usenames,dvipsnames]{xcolor} % load early to avoid name clash
\usepackage{verbatim}  % \begin{comment} support
\usepackage{eso-pic}   % AddToShipoutPicture support
\usepackage{units}   % nice fractions (like "1/2")
\usepackage{multicol}  % 2-columns

% --- colors -----------------------------------------------------------
\DefineNamedColor{named}{primary}{cmyk}{0.75,0.68,0.67,0.90} % blacker than black
\DefineNamedColor{named}{silver}{rgb}{0.75, 0.75, 0.75}
\DefineNamedColor{named}{gainsboro}{cmyk}{ 0.00, 0.00, 0.00, 0.12}

% --- page & basic text setup ------------------------------------------

\usepackage[driver=none]{geometry}

\geometry{% Letter
  paperheight=11in,
  paperwidth=8.5in,
  margin=1in
}
% More space between columns
\setlength{\columnsep}{3em}

% Column macro
\newcommand{\cbreak} {
  \vfill\null
  \columnbreak
} 

% Don't indent paragraphs, add some space instead
\setlength{\parindent}{0em}
\setlength{\parskip}{3mm}


% --- header and footer ------------------------------------------------

\usepackage{fancyhdr}

\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\small\fftext\yggVersion}
\fancyhead[R]{\small\fftext{The Totality of Ygg}}
\fancyfootoffset[RO,L]{0mm}
\fancyfoot[C]{\bf\color{primary}\fftext\thepage}
\renewcommand{\headrulewidth}{.25pt}
\renewcommand{\footrulewidth}{.25pt}

% --- pdf tweaks -------------------------------------------------------

% fix a transparent png rendering bug
\AddToShipoutPicture{%
\makeatletter%
\special{pdf: put @thispage <</Group << /S /Transparency /I true /CS /DeviceRGB>> >>}%
\makeatother%
}

\usepackage{ocgx} % for pdf layer support

% --- fonts & symbols --------------------------------------------------

\usepackage{fontspec}
\ifdefined\fontsearchpath\else\newcommand{\fontsearchpath}{../fonts}\fi

% Free Futura font, based off of TSR's PH1e
\newfontfamily{\fftext}[
  Path=\fontsearchpath/futura/,
  Mapping=tex-text,
  UprightFont={FuturaBook},
  ItalicFont={FuturaBook-Italic},
  BoldFont={Futura-Bold}
]{FuturaBook}

% Fredericka the Great
\newfontfamily{\fffancy}[
  Path=\fontsearchpath/fredericka-the-great/,
  Mapping=tex-text,
  UprightFont={FrederickatheGreat-Regular}
]{FrederickatheGreat}

% Symbols
\newfontfamily{\ffstixmath}[
  Path=\fontsearchpath/stix/,
  Mapping=tex-text,
  Extension={.otf},
  UprightFont={STIX2Math},
  BoldFont={STIX2Math},
  ItalicFont={STIX2Math},
  BoldItalicFont={STIX2Math} 
]{STIX2Math}

% --- symbol macros --------------------------------------------------
\usepackage[T1]{fontenc}
\usepackage{lmodern}

% 6-sided die
\newcommand{\diceglyph}{\ffstixmath{\char"2685}}
\newcommand{\LVL}{{\fftext \textbf{[lvl] }}}
\newcommand{\MAX}{{\fftext \textbf{[max] }}}
\newcommand{\SUM}{{\fftext \textbf{[sum] }}}
\newcommand{\FE}{{\fftext{fe}}}
\newcommand{\AU}{{\fftext{ag}}}
\newcommand{\AG}{{\fftext{au}}}

\newcommand{\DCUP}{{\fftext \textbf{DC\ffstixmath{\char"21E7} }}}
\newcommand{\DCDOWN}{{\fftext \textbf{DC\ffstixmath{\char"21E9} }}}
\newcommand{\PLUS}{{\fftext \textbf{\ffstixmath{\char"002B} }}}

\newcommand{\RB}{{\fftext \textbf{R\ffstixmath{\char"29C1} }}}
\newcommand{\RS}{{\fftext \textbf{R\ffstixmath{\char"2713} }}}
\newcommand{\RO}{{\fftext \textbf{R\ffstixmath{\char"2473} }}}

\newcommand{\INT}{\protect\mylink{\fftext \textbf{\ffstixmath{\char"2666}}INT }{tangible-stats-intellect}}
\newcommand{\FOC}{\protect\mylink{\fftext \textbf{\ffstixmath{\char"2665}}FOC }{tangible-stats-focus}}
\newcommand{\VIG}{\protect\mylink{\fftext \textbf{\ffstixmath{\char"2663}}VIG }{tangible-stats-vigor}}
\newcommand{\DEX}{\protect\mylink{\fftext \textbf{\ffstixmath{\char"2660}}DEX }{tangible-stats-dexterity}}

\newcommand{\UD}{\protect\mylink{\fftext \textbf{U\diceglyph}}{dice-usage-dice}}
\newcommand{\MD}{\protect\mylink{\fftext \textbf{M\diceglyph}}{combat-move-die}}
\newcommand{\HD}{\protect\mylink{\fftext \textbf{Hit\diceglyph}}{hit-dice}}
\newcommand{\STATIC}{\protect\mylink{\fftext \textbf{Static\diceglyph}}{dice-static-dice}}
\newcommand{\POOL}{\protect\mylink{\fftext \textbf{Pool\diceglyph}}{dice-pool-dice}}
\newcommand{\DEATH}{\protect\mylink{\fftext \textbf{Pool\diceglyph}}{combat-death-die}}
\newcommand{\KNACK}{\protect\mylink{\fftext \textbf{Knack\diceglyph}}{dice-knack-dice}}
\newcommand{\DEED}{\fftext \textbf{Deed\diceglyph}}
\newcommand{\FLESH}{\fftext \textbf{Flesh\diceglyph}}
\newcommand{\LUCK}{\fftext \textbf{Luck\diceglyph}}
\newcommand{\KNAVE}{\fftext \textbf{Knave\diceglyph}}


\newcommand{\DubArrw}{{\fftext \textbf{\ffstixmath{\char"21D4} }}}
\newcommand{\Tilde}{{\fftext \textbf{\ffstixmath{\char"223C} }}}
\newcommand{\TheAuthority}{
  {
    \fontfamily{lmr}\selectfont {
      M\={a}na-Yood-Sush\={a}\={i}
    }
  }
}

% --- section headers --------------------------------------------------
\usepackage[compact]{titlesec}

% Vertical center title page
\usepackage{titling}
\renewcommand\maketitlehooka{\null\mbox{}\vfill}
\renewcommand\maketitlehookd{\vfill\null}

% hide the section numbers
\renewcommand\thesection{}
\renewcommand\thesubsection{}
\renewcommand\thesubsubsection{}

% set the ToC depth
\setcounter{tocdepth}{3}

\titleformat*{\section}{\Huge\bfseries\fffancy\filcenter}
\titleformat*{\subsection}{\Huge\bfseries\raggedleft\fftext}
\titleformat*{\subsubsection}{\Large\bfseries\raggedright\fftext}
\titleformat*{\paragraph}{\large\bfseries\raggedright\fftext}


\newcommand{\mychapter}[2]{
  \topskip0pt
  \vspace*{\fill}
  \hypertarget{#2}{%
    \section{#1}\zlabel{#2}
  }
  \vspace*{\fill}
}


\newcommand{\mysection}[2]{
  \hypertarget{#2}{%
    \subsection{#1}\zlabel{#2}
  }
} 

\newcommand{\mysubsection}[2]{
  \hypertarget{#2}{%
    \subsubsection{#1}\zlabel{#2}
   }
   \hrule height1mm
} 

\newcommand{\myhighlight}[2]{
  \hypertarget{#2}{%
    \paragraph{#1}\zlabel{#2} \hfill
  }
} 


% --- page references --------------------------------------------------

\usepackage{zref-user,zref-titleref,zref-hyperref}
\newcommand{\refPage}[1]{\book\,\zpageref{#1}}

% --- common style items -----------------------------------------------

\newcommand{\mybold}[1]{{\textbf{#1}}}
\newcommand{\myital}[1]{{\textit{#1}}}
\newcommand{\mylink}[2]{
  \hyperlink{#2}{#1}
}
\newcommand{\myanchor}[2]{
  \hypertarget{#2}{#1}
}


% --- tables -----------------------------------------------------------

\usepackage{tabularx}
\usepackage{colortbl}
\usepackage{ragged2e}
\usepackage{multirow}
\usepackage{dcolumn}

\renewcommand{\tabcolsep}{1mm}

\newcolumntype{x}[1]{%
>{\raggedright\hspace{0pt}}p{#1}%
}
\newcolumntype{y}[1]{%
>{\centering\hspace{0pt}}p{#1}%
}
\newcolumntype{z}[1]{%
>{\raggedleft\hspace{0pt}}p{#1}%
}

\newcommand{\thead}[1]{
  \fftext\textbf{
    \noindent%
    \rowcolors[]{1}{white}{}%
    \color{primary}#1
  }
}

\newcommand{\tn}{\tabularnewline}

\newcommand{\mytable}[4][\fftext\normalsize]{
  \renewcommand{\arraystretch}{0.95}{
    {#1%
    \vspace{2pt plus 6pt}%
    \noindent%
    \rowcolors[]{1}{silver}{}%
    \RaggedRight\setlength{\extrarowheight}{0.15\baselineskip}%
    \begin{tabularx}{\columnwidth}{#2}
    \rowcolor{white}
    #3 % header
    \rowcolor{silver}
    #4 % body
    \end{tabularx}\vspace{2pt plus 6pt}
    }
  }
}



% --- lists ------------------------------------------------------------

\newcommand{\mylist}[1]{%
  \begin{list}{
    \color{primary}}{\leftmargin=1.5em\itemsep=3pt\parsep=0pt}#1
  \end{list}
}

\newcommand{\mybullet}[1]{%
  \begin{itemize}{
    \color{primary}}{\leftmargin=1.5em\itemsep=3pt\parsep=0pt}#1
  \end{itemize}
}

\newcommand{\mynumlist}[1]{%
  \begin{enumerate}{
    \color{primary}}{\leftmargin=1.5em\itemsep=3pt\parsep=0pt}#1
  \end{enumerate}
}

% --- example block ------------------------------------------------------------
\usepackage{tcolorbox}
\newcommand{\example}[1] {%
  \begin{tcolorbox}[width=\linewidth,colback={gainsboro}]
    \centering
    #1
  \end{tcolorbox}
}

% --- flavor block ------------------------------------------------------------
\newcommand{\flavor}[1] {%
  \begin{tcolorbox}[width=\linewidth,colback=white]
    \centering
    \myital{#1}
  \end{tcolorbox}
}


% A way to produce similar looking "statblocks"
% 1 = NSC/Monster name, e.g. "Giant rat"
% 2 = hit die, e.g. "4"
% 3 = action die, e.g. "6"
% 4 = reaction die, e.g. "4"
\newcommand{\nsc}[4]{\keyword{#1:} \HD#2 \AD#3 \RD#4}


% some usefull default pdf settings
% this needs to go last in order to generate
% a PDF index
\usepackage{hyperref}
\hypersetup{
  pdfpagelayout=TwoPageRight,
  pdfstartview=Fit,
  pdfpagemode=UseOutlines,
  pdfprintscaling=None,
  colorlinks=true,
  bookmarksnumbered=true,
  bookmarksopen=true,
  linkcolor = blue,
  anchorcolor = blue,
}
\usepackage{hypcap}